---
description: 'Principles of writing readable and maintainable code based on "The Art of Readable Code"'
applyTo: '**/*.{ts,js,gs,html}'
---

# Readable Code Guidelines

> 「コードは他の人が最短時間で理解できるように書かなければならない」

## 1. 命名 (Naming)

### 具体的な名前を選ぶ
- `get` の代わりに、状況に応じて `fetch`, `retrieve`, `calculate`, `extract` などを使用する。
- `size` よりも `height`, `num_nodes`, `memory_bytes` など、何の種類か明確にする。

### 汎用的な名前を避ける
- `tmp`, `data`, `item`, `value` などの名前は、それが何を表しているか具体化する。
  - *例外: スコープが数行以内で、一時的であることが自明な場合は `tmp` を使っても良い。*
- ループ変数 `i`, `j`, `k` の代わりに、`user_index`, `column_idx` など、多重ループ時でも混同しない名前を検討する。

### 属性を追加する
- 時間やデータ量などの数値には単位を付ける (`timeout_ms`, `max_kb`, `delay_seconds`)。
- 危険なデータや加工前のデータにはプレフィックスを付ける (`untrusted_input`, `raw_html`)。

### ブール値の命名
- `is`, `has`, `can`, `should` を使い、真偽が明確な名前にする。
- 否定的な名前 (`is_not_authenticated`) よりも肯定的な名前 (`is_authenticated`) を優先する。

## 2. 制御フロー (Simplifying Control Flow)

### 条件式の並び
- 変化する値（調査対象）を左に、変化しない値（比較対象）を右に置く。
  - `if (length >= 10)` は良いが、 `if (10 <= length)` は避ける。

### if/else の並び
- 肯定的なケースを先に書く。
- 単純なケースを先に書く。
- 興味深く、目立つケースを先に書く。

### ガード節 (Early Return)
- 関数のネストを深くしないために、異常系やエッジケースは関数の先頭で `return` させる。
- 「正常系が常にインデントの最も浅い位置にある」状態を維持する。

### 三項演算子の使い所
- 行が短く、単純な代入にのみ使用する。複雑な論理には `if/else` を使う。

## 3. 式の分割 (Breaking Down Expressions)

### 説明変数
- 複雑な条件式や計算式には、その意味を説明する変数を導入する。
  ```typescript
  const is_admin = user.role === 'ADMIN';
  const has_expired = subscription.end_date < Date.now();
  if (is_admin || !has_expired) { ... }
  ```

### 要約変数
- 大きなデータ構造から特定の値を抽出して使い回す場合、短い名前の変数に代入する。

### ド・モルガンの法則
- `!(a && b)` は `(!a || !b)` と等価。より直感的な方に整理する。

## 4. 変数とスコープ (Variables and Scope)

### スコープを縮める
- 変数の有効範囲はできるだけ小さく保つ。
- グローバル変数は原則禁止。クラスやモジュールのプライベート変数を検討する。

### 変数は一度だけ書き込む (Immutable)
- 変数への代入回数が多いほど、追跡が困難になる。可能な限り `const` を使い、一度だけ値を設定するようにする。

## 5. コメント (Writing Better Comments)

### コードからわかることは書かない
- 「何をしているか」ではなく「なぜそうしたか（Why）」や「どのように使うべきか」を優先する。
- 悪いコードをコメントで取り繕うのではなく、コード自体を修正する。

### 自分の考えを記録する
- 「なぜこのアルゴリズムを選んだか」
- 「この定数 720 は 24時間 * 30分 を意味している」
- 「ここを修正するときの注意点」

### 監督のコメンタリー / 欠陥の記録
- `// TODO:` あとでやる
- `// FIXME:` 既知の不具合がある
- `// HACK:` 綺麗ではないが、動くための妥協
- `// XXX:` 危険！大きな問題がある

## 6. 美しさ (Aesthetics)

### 段落分け
- 関連するコードをブロックにまとめ、論理的な区切りに空行を入れる。

### 縦の整列
- 似たような代入文やパラメータが並ぶ場合、構造を揃えて一目で差分がわかるようにする。

### 一貫性
- プロジェクト全体で、同じような処理には同じ命名規則、同じ構造を適用する。
